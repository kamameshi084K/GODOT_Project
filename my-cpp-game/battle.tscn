[gd_scene load_steps=13 format=3 uid="uid://bibskgs0n504k"]

[ext_resource type="PackedScene" uid="uid://c2q25qg6bk65v" path="res://assets/Birb.gltf" id="1_ip7xm"]
[ext_resource type="PackedScene" uid="uid://b8b7wkkpqn0xf" path="res://assets/Warrior.gltf" id="1_oxp8w"]

[sub_resource type="Environment" id="Environment_w7wwj"]
background_mode = 2

[sub_resource type="PlaneMesh" id="PlaneMesh_ip7xm"]
size = Vector2(20, 20)

[sub_resource type="StyleBoxFlat" id="StyleBoxFlat_oxp8w"]
bg_color = Color(0, 1, 0, 1)

[sub_resource type="StyleBoxFlat" id="StyleBoxFlat_ip7xm"]
bg_color = Color(0.6, 0.6, 0.6, 0)

[sub_resource type="StyleBoxFlat" id="StyleBoxFlat_i431l"]
bg_color = Color(0.6, 0.6, 0.6, 0)
border_width_left = 2
border_width_top = 2
border_width_right = 2
border_width_bottom = 2

[sub_resource type="StyleBoxFlat" id="StyleBoxFlat_7sfm4"]
bg_color = Color(0.6, 0.6, 0.6, 0)

[sub_resource type="StyleBoxFlat" id="StyleBoxFlat_6t8i5"]
bg_color = Color(0.6, 0.6, 0.6, 0)
border_width_left = 2
border_width_top = 2
border_width_right = 2
border_width_bottom = 2

[sub_resource type="Animation" id="Animation_7sfm4"]
resource_name = "EnemyAttackAction"
length = 2.0
tracks/0/type = "method"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath(".")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0.033333335, 0.96666664, 1.5),
"transitions": PackedFloat32Array(1, 1, 1),
"values": [{
"args": [],
"method": &"seq_enemy_attack_start"
}, {
"args": [],
"method": &"seq_enemy_deal_damage"
}, {
"args": [],
"method": &"seq_end_enemy_turn"
}]
}

[sub_resource type="Animation" id="Animation_oxp8w"]
resource_name = "PlayerAttackAction"
tracks/0/type = "method"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath(".")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0.16666667, 1),
"transitions": PackedFloat32Array(1, 1),
"values": [{
"args": [],
"method": &"seq_player_attack_start"
}, {
"args": [],
"method": &"seq_deal_damage"
}]
}

[sub_resource type="AnimationLibrary" id="AnimationLibrary_7sfm4"]
_data = {
&"EnemyAttackAction": SubResource("Animation_7sfm4"),
&"PlayerAttackAction": SubResource("Animation_oxp8w")
}

[node name="BattleScene" type="Node3D"]

[node name="WorldEnvironment" type="WorldEnvironment" parent="."]
environment = SubResource("Environment_w7wwj")

[node name="DirectionalLight3D" type="DirectionalLight3D" parent="."]
transform = Transform3D(0.70710677, -0.49999997, 0.49999997, 0, 0.70710677, 0.70710677, -0.70710677, -0.49999997, 0.49999997, -0.46368933, 9.036392, -0.8837156)
shadow_enabled = true

[node name="MeshInstance3D" type="MeshInstance3D" parent="."]
mesh = SubResource("PlaneMesh_ip7xm")

[node name="Camera3D" type="Camera3D" parent="."]
transform = Transform3D(0.70710677, -0.35355338, 0.6123724, 0, 0.8660254, 0.5, -0.70710677, -0.35355338, 0.6123724, 5, 5, 5)

[node name="PlayerActor" type="MeshInstance3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.026491404, 4)

[node name="Warrior" parent="PlayerActor" instance=ExtResource("1_oxp8w")]
transform = Transform3D(-1, 0, -8.742278e-08, 0, 1, 0, 8.742278e-08, 0, -1, 0, 0, 0)

[node name="Skeleton3D" parent="PlayerActor/Warrior/CharacterArmature" index="0"]
bones/1/position = Vector3(0.057161584, 0.02466291, -0.34623444)
bones/1/rotation = Quaternion(0.46121293, 0.5351257, 0.54142517, -0.45583117)
bones/2/position = Vector3(0.0021529722, 1.0306468, 0.18307202)
bones/2/rotation = Quaternion(-3.8842844e-09, 0.3807618, 2.2728216e-08, 0.92467314)
bones/3/position = Vector3(-0.0014798869, -0.11307932, -0.11569902)
bones/3/rotation = Quaternion(-0.114374466, -1.3553868e-07, -6.7854366e-08, 0.9934377)
bones/4/rotation = Quaternion(0.22969253, -0.11355864, 0.00045984238, 0.9666156)
bones/5/rotation = Quaternion(-0.07018116, -0.022675822, 0.010739435, 0.9972187)
bones/6/rotation = Quaternion(-0.0031907547, 0.00066388503, 0.018282862, 0.99982756)
bones/7/rotation = Quaternion(0.032626223, -0.24456424, 0.038007416, 0.9683385)
bones/8/position = Vector3(0.12610286, 0.14141415, 0.012646058)
bones/9/rotation = Quaternion(0.68843657, 0.43910852, 0.37905067, -0.43538418)
bones/10/rotation = Quaternion(-0.20866966, 0.10193904, -0.22283623, 0.946789)
bones/11/rotation = Quaternion(0.01980031, 0.017442679, -0.00852201, 0.9996155)
bones/12/rotation = Quaternion(-0.06264131, -0.01881044, -0.001180834, 0.99785817)
bones/13/rotation = Quaternion(-0.14578031, 2.5357952e-08, 3.621452e-08, 0.989317)
bones/14/rotation = Quaternion(-0.1710575, 0.083744615, -0.43297884, 0.8810536)
bones/15/rotation = Quaternion(-0.07893173, -0.2979136, 0.14166275, 0.94071734)
bones/16/position = Vector3(-0.12482598, 0.1414144, 0.012646196)
bones/16/rotation = Quaternion(-0.033020813, 0.014954075, 0.41228098, 0.91033536)
bones/17/rotation = Quaternion(0.29446825, -0.6436683, -0.5635624, -0.42588395)
bones/18/rotation = Quaternion(-0.07235177, -0.05135128, 0.46467638, 0.88102454)
bones/19/rotation = Quaternion(0.019800322, -0.017442642, 0.008522018, 0.9996155)
bones/20/rotation = Quaternion(-0.06264138, 0.018810432, 0.0011808339, 0.99785817)
bones/21/rotation = Quaternion(-0.620148, -0.08527078, -0.032721315, 0.77915)
bones/22/rotation = Quaternion(1.1734666e-07, -5.029142e-08, -4.957406e-15, 1)
bones/23/rotation = Quaternion(-0.17105757, -0.08374458, 0.43297896, 0.88105357)
bones/24/rotation = Quaternion(-0.07893175, 0.29791364, -0.14166285, 0.9407172)
bones/25/position = Vector3(0.19541883, 0.018798226, -0.09142392)
bones/25/rotation = Quaternion(0.9744084, 0.15171003, -0.14863123, 0.07362933)
bones/26/rotation = Quaternion(0.32621816, 0.003082481, 0.007480202, 0.94525987)
bones/27/position = Vector3(-0.20403647, 0.018798037, -0.09142422)
bones/27/rotation = Quaternion(0.9728541, -0.04241385, -0.034913696, 0.22480467)
bones/28/rotation = Quaternion(0.42534143, -0.0038640592, -0.00710805, 0.9049968)
bones/29/position = Vector3(0.5242208, 0.3013218, -0.030022144)
bones/29/rotation = Quaternion(-3.5526934e-15, 1.1920937e-07, -8.470344e-22, 1)
bones/30/position = Vector3(-0.27776012, 0.024662832, 0.32672226)
bones/30/rotation = Quaternion(0.26499212, 0.6523354, 0.66002864, -0.26191595)
bones/31/position = Vector3(0.064815134, 0.34280226, 0.59965056)
bones/31/rotation = Quaternion(-3.552734e-15, -5.9604645e-07, 3.3881257e-21, 1)

[node name="Head" parent="PlayerActor/Warrior/CharacterArmature/Skeleton3D" index="0"]
transform = Transform3D(0.998302, -0.0567693, 0.013051689, 0.058203783, 0.98110175, -0.18453196, -0.0023290813, 0.18497834, 0.98274, -0.061550118, 2.0149143, 0.18487151)

[node name="UpperArm_L" parent="PlayerActor/Warrior/CharacterArmature/Skeleton3D" index="1"]
transform = Transform3D(0.8071409, 0.25560614, 0.532155, -0.08120016, -0.84477526, 0.528925, 0.584748, -0.47012803, -0.6610974, 0.21424107, 1.7613771, 0.004866153)

[node name="Weapon_R" parent="PlayerActor/Warrior/CharacterArmature/Skeleton3D" index="2"]
transform = Transform3D(-0.75379974, 0.5372112, -0.37840518, -0.58342075, -0.28220046, 0.7615666, 0.30233562, 0.7948376, 0.52614254, -0.24231379, 1.4082835, 1.0857508)

[node name="UpperArm_R" parent="PlayerActor/Warrior/CharacterArmature/Skeleton3D" index="3"]
transform = Transform3D(-0.7602685, -0.39178693, -0.518165, -0.26544416, -0.54066086, 0.7982641, -0.5929012, 0.7444384, 0.30704975, -0.34490424, 1.7526647, 0.31421003)

[node name="AnimationPlayer" parent="PlayerActor/Warrior" index="1"]
autoplay = "Idle_Attacking"

[node name="EnemyActor" type="MeshInstance3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, -4)

[node name="Birb2" parent="EnemyActor" instance=ExtResource("1_ip7xm")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, -0.90294194, 0)

[node name="AnimationPlayer" parent="EnemyActor/Birb2" index="1"]
autoplay = "Idle"

[node name="CanvasLayer" type="CanvasLayer" parent="."]

[node name="BattleUI" type="BattleUI" parent="CanvasLayer"]
enemy_anim_path = NodePath("../../EnemyActor/Birb2/AnimationPlayer")
player_anim_path = NodePath("../../PlayerActor/Warrior/AnimationPlayer")
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2

[node name="PlayerHPBar" type="ProgressBar" parent="CanvasLayer/BattleUI"]
layout_mode = 0
offset_left = 213.0
offset_top = 242.0
offset_right = 429.0
offset_bottom = 269.0
theme_override_styles/fill = SubResource("StyleBoxFlat_oxp8w")
max_value = 10.0
value = 10.0
show_percentage = false

[node name="CommandWindow" type="PanelContainer" parent="CanvasLayer/BattleUI"]
layout_mode = 1
anchors_preset = -1
anchor_left = 0.055555556
anchor_top = 0.67579013
anchor_right = 0.20713194
anchor_bottom = 0.91358024
offset_top = 0.08798218
offset_right = 0.3840027
grow_vertical = 0
metadata/_edit_use_anchors_ = true

[node name="VBoxContainer" type="VBoxContainer" parent="CanvasLayer/BattleUI/CommandWindow"]
layout_mode = 2

[node name="AttackButton" type="Button" parent="CanvasLayer/BattleUI/CommandWindow/VBoxContainer"]
custom_minimum_size = Vector2(150, 75)
layout_mode = 2
theme_override_colors/font_color = Color(1, 1, 1, 1)
theme_override_font_sizes/font_size = 25
theme_override_styles/normal = SubResource("StyleBoxFlat_ip7xm")
theme_override_styles/focus = SubResource("StyleBoxFlat_i431l")
text = "たたかう"

[node name="RunButton" type="Button" parent="CanvasLayer/BattleUI/CommandWindow/VBoxContainer"]
custom_minimum_size = Vector2(0, 75)
layout_mode = 2
theme_override_colors/font_color = Color(1, 1, 1, 1)
theme_override_font_sizes/font_size = 25
theme_override_styles/normal = SubResource("StyleBoxFlat_7sfm4")
theme_override_styles/focus = SubResource("StyleBoxFlat_6t8i5")
text = "にげる"

[node name="MessageWindow" type="PanelContainer" parent="CanvasLayer/BattleUI"]
visible = false
custom_minimum_size = Vector2(1000, 0)
layout_mode = 1
anchors_preset = 7
anchor_left = 0.5
anchor_top = 1.0
anchor_right = 0.5
anchor_bottom = 1.0
offset_left = -20.0
offset_top = -167.0
offset_right = 20.0
offset_bottom = -111.0
grow_horizontal = 2
grow_vertical = 0

[node name="MessageLabel" type="Label" parent="CanvasLayer/BattleUI/MessageWindow"]
layout_mode = 2

[node name="Sequencer" type="AnimationPlayer" parent="CanvasLayer/BattleUI"]
libraries = {
&"": SubResource("AnimationLibrary_7sfm4")
}

[connection signal="pressed" from="CanvasLayer/BattleUI/CommandWindow/VBoxContainer/AttackButton" to="CanvasLayer/BattleUI" method="_on_attack_button_pressed"]
[connection signal="pressed" from="CanvasLayer/BattleUI/CommandWindow/VBoxContainer/RunButton" to="CanvasLayer/BattleUI" method="_on_run_button_pressed"]

[editable path="PlayerActor/Warrior"]
[editable path="EnemyActor/Birb2"]
